# حالة المشروع — Fahimo (حالة مستقرة)

التاريخ: 2025-12-11

ملخص سريع:
- الكود مستقر محلياً وتم تحديث واجهة الويدجت والداشبورد وخدمات الـAI والـembedding.
- تم إصلاح مشاكل بناء Next.js الناتجة عن حروف غير قابلة للطباعة في صفحة الوثائق.
- تم نشر نسخة مُحسّنة من الـwidget على الخادم (تحققنا من الملف المنشور).

التغييرات الرئيسية التي أُجريت مؤخرًا:
- واجِهة الويدجت (`server/public/fahimo-widget.js`): دمجت سكربت واحد موحّد، أضفت "جاري الرد" كـ typing indicator، تحسينات على التخزين المحلي للجلسات، وتنقية أسماء الـbot لإزالة "demo".
- خدمات الـembedding وAI (`server/src/services`): التفضيل لاستخدام نماذج Groq، إضافة منطق إعادة المحاولة، وfallback/Gemini cooldown عند حدوث 429.
- صفحة الوثائق (`client/src/app/docs/page.jsx`): تم إزالة الأحرف المُسببة للمشكلة واستبدالها بمكوّن وثائق عربي متدرّج (قابل للتوسيع).
- واجهة التحمّل والداشبورد: توحيد واجهة التحميل، تحسين أسماء الزوار في القوائم (عرض Country • visitorID)، وتنسيق أزرار "عرض الكل / عرض أقل" بلون مميز.
- شعار التطبيق: الآن يظهر شعار صغير أنيق في القائمة الجانبية على الموبايل (تعديلات على `FaheemAnimatedLogo`).
- رسائل البوت: الآن تُعرض بشكل مرتب — إن كان الرد متعدد الأسطر يظهر كقائمة مرقّمة، و`**البولد**` يتم تحويله إلى نص غامق.

ما تم تغييره في الملفات (نموذجي):
- `client/src/components/FaheemAnimatedLogo.jsx` — دعم حجم صغير/صغير جدًا للعرض على الموبايل.
- `client/src/components/chat/MessageBubble.jsx` — تحويل ردود البوت متعددة الأسطر إلى قوائم مرقّمة ودعم `**bold**`.
- `client/src/app/dashboard/components/ConversationsView.jsx` — عرض `Country • visitorID` وتنظيف المحتوى بدون حذف علامات الـbold.
- `client/src/app/dashboard/components/LiveSupportView.jsx` — نفس التحسين لعرض الزوار.

نقاط الأمان والاستقرار الموصى بها (لتجنّب تكرار المشاكل):
- Purge كاش/CDN بعد أي نشر للـ`fahimo-widget.js` أو استخدم اسم ملف مُهَرَّب (مثلاً `fahimo-widget.v2.js`).
- أضف فحصاً في pre-commit أو CI لاكتشاف أحرف غير قابلة للطباعة (مثل U+0000 .. U+001F وU+007F) في ملفات JSX/JS.
- سجّل/نقّح الأخطاء الحرجة في CI: شغّل `npm run build` على كل PR وتوقّف عن الدمج إن فشل البناء.
- إضافة اختبارات وحدوية بسيطة للقواعد الحرجة (rendering لرسائل البوت وتنسيق الزوار) لتجنب كسر واجهة المستخدم.
- عدم تعديل `process.env` أثناء التشغيل (تم ضبط الخدمات لذلك بالفعل).

الخطوات التالية المقترحة (أحتاج موافقتك لتنفيذ أيٍ منها):
1) إنهاء صفحة الوثائق الاحترافية بالكامل (أنا أملأها وأجري build محلي).  
2) تنفيذ استراتيجية إصدار للـwidget (versioned filename) أو تنفيذ Purge للـCDN (تحتاج بيانات اعتماد CDN/Render).  
3) إضافة pre-commit hook (lint + invisible-char check) وCI build check.

هل تُريد أن أبدأ مباشرةً بـ(1) إكمال صفحة الوثائق أم (2) أركّز على نشر نسخة ذات اسم إصدار للـwidget/مطالبة بحذف الكاش؟


---
ملحوظة: إن رغبت، أقدّم ملفًا تفصيليًا بالخطوات التقنية لإعداد CI (GitHub Actions) يتضمن فحص الحروف غير المرئية وبناء الـclient والـserver ونشر إذا نجح البناء.