version: '3.8'
services:
  pgbouncer:
    image: edoburu/pgbouncer:1.16.0
    container_name: pgbouncer
    restart: unless-stopped
    ports:
      - "6432:6432" # host:container
    environment:
      # Set this to your upstream DATABASE_URL (Postgres)
      - DATABASE_URL=${DATABASE_URL}
      - POOL_MODE=transaction
      - MAX_CLIENT_CONN=100
      - DEFAULT_POOL_SIZE=20
    volumes:
      - ./pgbouncer.ini:/etc/pgbouncer/pgbouncer.ini:ro
      - ./userlist.txt:/etc/pgbouncer/userlist.txt:ro
    networks:
      - pgbouncer-net

networks:
  pgbouncer-net:
    driver: bridge
