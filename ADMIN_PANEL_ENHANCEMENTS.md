# ุชุญุณููุงุช ููุญุฉ ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ (Admin Panel Enhancements)

## ๐ ููุฎุต ุงูุชุญุณููุงุช

ุชู ุฅุฌุฑุงุก ูุฑุงุฌุนุฉ ุดุงููุฉ ูุชุญุณููุงุช ูุชูุฏูุฉ ุนูู ููุญุฉ ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ (Admin Panel) ูููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ (Super Admin Panel) ูุถูุงู:
- โ ูู ุดูุก ููุทูู ููุชุฑุงุจุท
- โ ุฌููุน ุงูุฎุตุงุฆุต ุชุนูู ุจุดูู ุตุญูุญ
- โ ุฅุถุงูุฉ ููุฒุงุช ููููุฏุฉ ููุชูุฏูุฉ

---

## ๐ง ุงูุฅุตูุงุญุงุช ุงูุฑุฆูุณูุฉ

### 1. ุชูุนูู Admin Extended Routes
- **ุงููุดููุฉ**: ูุงูุช `admin-extended.routes.js` ูุนุทูุฉ ูู `index.js`
- **ุงูุญู**: ุชู ุชูุนูููุง ูุฅุตูุงุญ ูุดููุฉ `protect` middleware
- **ุงููููุงุช**: 
  - `server/src/index.js`
  - `server/src/routes/admin-extended.routes.js`
  - `server/src/middleware/auth.js` (ุฅุถุงูุฉ `protect` alias)

### 2. ุชุญุณูู ูุธุงู ุงูุตูุงุญูุงุช
- ุงุณุชุฎุฏุงู `requirePermission` ูู `authorization.js` ุจุดูู ููุญุฏ
- ุฏุนู ุตูุงุญูุงุช ุฏูููุฉ ููู endpoint
- ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ูู Audit Log

---

## ๐ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ุงููุถุงูุฉ

### 1. ุฅุฏุงุฑุฉ ุงูุฃุนูุงู (Business Management)
**ุงูููู**: `server/src/routes/admin-business.routes.js`

#### ุงูููุฒุงุช:
- โ **GET `/api/admin/businesses`** - ุนุฑุถ ุฌููุน ุงูุฃุนูุงู ูุน pagination ูfiltering
- โ **GET `/api/admin/businesses/:id`** - ุชูุงุตูู ุนูู ูุนูู
- โ **PUT `/api/admin/businesses/:id`** - ุชุญุฏูุซ ุจูุงูุงุช ุงูุนูู
- โ **PUT `/api/admin/businesses/:id/quota`** - ุฅุฏุงุฑุฉ ุงูุญุตุต (Quota Management)
- โ **PUT `/api/admin/businesses/:id/plan`** - ุชุบููุฑ ููุน ุงูุฎุทุฉ
- โ **DELETE `/api/admin/businesses/:id`** - ุญุฐู ุนูู (Soft Delete)
- โ **POST `/api/admin/businesses/:id/activate`** - ุชูุนูู ุนูู ูุนุทู
- โ **GET `/api/admin/businesses/:id/stats`** - ุฅุญุตุงุฆูุงุช ููุตูุฉ ููุนูู

#### ุนูููุงุช ุฌูุงุนูุฉ (Bulk Operations):
- โ **POST `/api/admin/businesses/bulk-update`** - ุชุญุฏูุซ ุฌูุงุนู ูุนุฏุฉ ุฃุนูุงู
- โ **POST `/api/admin/businesses/bulk-reset-quota`** - ุฅุนุงุฏุฉ ุชุนููู ุงูุญุตุต ูุนุฏุฉ ุฃุนูุงู

#### Export:
- โ **GET `/api/admin/businesses/:id/export`** - ุชุตุฏูุฑ ุจูุงูุงุช ุงูุนูู (GDPR compliance)

---

### 2. ุฅุฏุงุฑุฉ ุงููุญุงุฏุซุงุช (Conversation Management)
**ุงูููู**: `server/src/routes/admin-conversations.routes.js`

#### ุงูููุฒุงุช:
- โ **GET `/api/admin/conversations`** - ุนุฑุถ ุฌููุน ุงููุญุงุฏุซุงุช ูุน pagination
- โ **GET `/api/admin/conversations/:id`** - ุชูุงุตูู ูุญุงุฏุซุฉ ูุน ุฌููุน ุงูุฑุณุงุฆู
- โ **DELETE `/api/admin/conversations/:id`** - ุญุฐู ูุญุงุฏุซุฉ
- โ **POST `/api/admin/conversations/bulk-delete`** - ุญุฐู ุฌูุงุนู ูููุญุงุฏุซุงุช

#### ุงูุชุญูููุงุช (Analytics):
- โ **GET `/api/admin/conversations/analytics`** - ุชุญูููุงุช ุดุงููุฉ ูููุญุงุฏุซุงุช:
  - ุฅุญุตุงุฆูุงุช ุญุณุจ ุงูุญุงูุฉ (Status)
  - ุฅุญุตุงุฆูุงุช ููููุฉ
  - ูุชูุณุท ุงูุฑุณุงุฆู ููู ูุญุงุฏุซุฉ
  - ุฃูุถู ุงูุฃุนูุงู ุญุณุจ ุนุฏุฏ ุงููุญุงุฏุซุงุช

---

### 3. ุฅุฏุงุฑุฉ ูุงุนุฏุฉ ุงููุนุฑูุฉ (Knowledge Base Management)
**ุงูููู**: `server/src/routes/admin-knowledge.routes.js`

#### ุงูููุฒุงุช:
- โ **GET `/api/admin/knowledge`** - ุนุฑุถ ุฌููุน ูุฏุฎูุงุช ูุงุนุฏุฉ ุงููุนุฑูุฉ
- โ **GET `/api/admin/knowledge/stats`** - ุฅุญุตุงุฆูุงุช ูุงุนุฏุฉ ุงููุนุฑูุฉ:
  - ุฅุฌูุงูู ุงููุฏุฎูุงุช
  - ุงูุชูุฒูุน ุญุณุจ ุงูููุน
  - ุงูุชูุฒูุน ุญุณุจ ุงูุนูู
  - ุฃุญุฏุซ ุงููุฏุฎูุงุช
- โ **DELETE `/api/admin/knowledge/:id`** - ุญุฐู ูุฏุฎู
- โ **POST `/api/admin/knowledge/bulk-delete`** - ุญุฐู ุฌูุงุนู

---

### 4. ุชุญุณููุงุช ุนูู Routes ุงูููุฌูุฏุฉ

#### Admin Routes (`server/src/routes/admin.routes.js`):

**ุชุญุณูู `/api/admin/stats`**:

**ุชุญุณูู `/api/admin/users`**:
 - Added Playwright E2E scaffolding and an initial E2E test (admin payments flows: edit gateway, create custom payment).
 - Updated CI to run Playwright E2E tests after building the client.
- Added confirmation modal and UX improvements for gateway key updates (admins must confirm replacing API/Secret keys). Unit tests cover this flow; E2E test added and will be stabilized to run reliably in CI.
- Added a manual production deployment workflow (`.github/workflows/deploy-prod.yml`) that can trigger Render deploys and optionally run Playwright against https://faheemly.com. See `DEPLOYMENT_TO_PROD.md` for the checklist and secrets required.
- ุงูุจุญุซ ูู ุงูุฑุณุงุฆู

---

## ๐ ูุธุงู ุงูุตูุงุญูุงุช

### ุงูุตูุงุญูุงุช ุงููุณุชุฎุฏูุฉ:
- `system:read` - ูุฑุงุกุฉ ุจูุงูุงุช ุงููุธุงู
- `system:update` - ุชุญุฏูุซ ุจูุงูุงุช ุงููุธุงู
- `system:delete` - ุญุฐู ุจูุงูุงุช ุงููุธุงู
- `users:read` - ูุฑุงุกุฉ ุจูุงูุงุช ุงููุณุชุฎุฏููู
- `users:create` - ุฅูุดุงุก ูุณุชุฎุฏููู
- `users:update` - ุชุญุฏูุซ ุจูุงูุงุช ุงููุณุชุฎุฏููู
- `users:delete` - ุญุฐู ูุณุชุฎุฏููู

### ุงูุฃุฏูุงุฑ (Roles):
- **SUPERADMIN**: ุตูุงุญูุงุช ูุงููุฉ ุนูู ุงููุธุงู
- **ADMIN**: ุตูุงุญูุงุช ูุญุฏูุฏุฉ
- **USER/CLIENT**: ุตูุงุญูุงุช ุฃุณุงุณูุฉ

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ูุงูุชุญูููุงุช

### ุฅุญุตุงุฆูุงุช ุงููุธุงู:
1. **ุงููุณุชุฎุฏููู**:
   - ุฅุฌูุงูู ุงููุณุชุฎุฏููู
   - ุงููุณุชุฎุฏููู ุงููุดุทูู
   - ุงููุณุชุฎุฏููู ุบูุฑ ุงููุดุทูู

2. **ุงูุฃุนูุงู**:
   - ุฅุฌูุงูู ุงูุฃุนูุงู
   - ุงูุฃุนูุงู ุงููุดุทุฉ
   - ุงูุชูุฒูุน ุญุณุจ ุงูุฎุทุฉ (TRIAL, START, GROWTH, ENTERPRISE)

3. **ุงููุญุงุฏุซุงุช**:
   - ุฅุฌูุงูู ุงููุญุงุฏุซุงุช
   - ุงููุญุงุฏุซุงุช ุงููุดุทุฉ
   - ุงููุญุงุฏุซุงุช ุงููุบููุฉ
   - ุงูุชูุฒูุน ุงููููู

4. **ุงูุฑุณุงุฆู**:
   - ุฅุฌูุงูู ุงูุฑุณุงุฆู
   - ุงูุฑุณุงุฆู ูู ุงููุชุฑุฉ ุงููุญุฏุฏุฉ
   - ูุชูุณุท ุงูุฑุณุงุฆู ููู ูุญุงุฏุซุฉ

5. **ุงูุญุตุต (Quota)**:
   - ุฅุฌูุงูู ุงูุญุตุต
   - ุงูุญุตุต ุงููุณุชุฎุฏูุฉ
   - ุงูุญุตุต ุงููุชุจููุฉ
   - ูุณุจุฉ ุงูุงุณุชุฎุฏุงู

---

## ๐ ุงูุนูููุงุช ุงูุฌูุงุนูุฉ (Bulk Operations)

### ุงูุฃุนูุงู:
- ุชุญุฏูุซ ุฌูุงุนู ููุนุฏูุฏ ูู ุงูุฃุนูุงู
- ุฅุนุงุฏุฉ ุชุนููู ุงูุญุตุต ูุนุฏุฉ ุฃุนูุงู

### ุงููุญุงุฏุซุงุช:
- ุญุฐู ุฌูุงุนู ูููุญุงุฏุซุงุช

### ูุงุนุฏุฉ ุงููุนุฑูุฉ:
- ุญุฐู ุฌูุงุนู ูููุฏุฎูุงุช

---

## ๐ค ุงูุชุตุฏูุฑ ูุงูุงุณุชูุฑุงุฏ

### ุชุตุฏูุฑ ุจูุงูุงุช ุงูุนูู:
- ุชุตุฏูุฑ ุดุงูู ูุจูุงูุงุช ุงูุนูู (GDPR compliance)
- ูุดูู:
  - ุจูุงูุงุช ุงูุนูู
  - ุจูุงูุงุช ุงููุณุชุฎุฏู
  - ุฌููุน ุงููุญุงุฏุซุงุช ูุงูุฑุณุงุฆู
  - ูุงุนุฏุฉ ุงููุนุฑูุฉ

---

## ๐ก๏ธ ุงูุฃูุงู ูุงููุฑุงูุจุฉ

### Audit Logging:
- ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ุงูุฅุฏุงุฑูุฉ
- ูุชุถูู:
  - ุงููุณุชุฎุฏู ุงูุฐู ูุงู ุจุงูุนูููุฉ
  - ููุน ุงูุนูููุฉ (CREATE, UPDATE, DELETE)
  - ุงูููุงู ุงููุชุฃุซุฑ
  - ุงูุชุบููุฑุงุช (Before/After)
  - IP Address ู User Agent
   - **ููุงุญุธุฉ:** ุชู ุฅุถุงูุฉ ูููุฐุฌ `AuditLog` ูู `prisma/schema.prisma` ููุฌุจ ุฅูุดุงุก ูุชุดุบูู migration ูุจู ุชูุนูู ุงูููุฒุฉ ูู ุงูุฅูุชุงุฌ (ุงูุธุฑ `DEPLOYMENT_TO_PROD.md`).

### Error Handling:
- ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- ุชุณุฌูู ุงูุฃุฎุทุงุก ูู Logger

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชูุงูู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช**:
   - ุจุนุถ ุงูุฌุฏุงูู ูุฏ ูุง ุชููู ููุฌูุฏุฉ (ูุซู `auditLog`, `systemLog`)
   - ุงูููุฏ ูุชุนุงูู ูุน ูุฐู ุงูุญุงูุงุช ุจุดูู ุขูู

2. **ุงูุฃุฏุงุก**:
   - ุงุณุชุฎุฏุงู pagination ูุฌููุน ุงูููุงุฆู
   - ุงุณุชุฎุฏุงู `select` ูุชูููู ุงูุจูุงูุงุช ุงููุณุชุฑุฌุนุฉ
   - ุงุณุชุฎุฏุงู `include` ุจุญุฐุฑ ูุชุฌูุจ N+1 queries

3. **ุงูุฃูุงู**:
   - ุฌููุน ุงูู endpoints ูุญููุฉ ุจู authentication
   - ุงุณุชุฎุฏุงู `requirePermission` ููุชุญูู ูู ุงูุตูุงุญูุงุช
   - ุนุฏู ูุดู ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ (ูุซู passwords)

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุชุฑุญุฉ

1. **ุฅุถุงูุฉ ูุงุฌูุฉ ูุณุชุฎุฏู (Frontend)**:
   - ุตูุญุงุช ูุฅุฏุงุฑุฉ ุงูุฃุนูุงู
   - ุตูุญุงุช ูุฅุฏุงุฑุฉ ุงููุญุงุฏุซุงุช
   - ุตูุญุงุช ููุฅุญุตุงุฆูุงุช ูุงูุชุญูููุงุช

2. **ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุชุญูููุงุช**:
   - ุชุญููู ุงููุดุงุนุฑ (Sentiment Analysis)
   - ุชุญููู ุงูุฃุฏุงุก (Performance Analytics)
   - ุชุญููู ุงูุงุณุชุฎุฏุงู (Usage Analytics)

3. **ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุนูููุงุช ุงูุฌูุงุนูุฉ**:
   - ุชุญุฏูุซ ุฌูุงุนู ููุฎุทุท
   - ุชุญุฏูุซ ุฌูุงุนู ููุญุงูุงุช

4. **ุฅุถุงูุฉ Backup/Restore**:
   - ูุณุฎ ุงุญุชูุงุทู ุชููุงุฆู
   - ุงุณุชุนุงุฏุฉ ูู ุงููุณุฎ ุงูุงุญุชูุงุทู

5. **ุฅุถุงูุฉ Real-time Monitoring**:
   - ูุฑุงูุจุฉ ูู ุงูููุช ุงููุนูู
   - ุชูุจููุงุช ุชููุงุฆูุฉ

---

## โ ุงูุฎูุงุตุฉ

ุชู ุฅุฌุฑุงุก ุชุญุณููุงุช ุดุงููุฉ ุนูู ููุญุฉ ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ:
- โ ุชูุนูู ุฌููุน ุงูู routes ุงููุนุทูุฉ
- โ ุฅุถุงูุฉ ุฅุฏุงุฑุฉ ุดุงููุฉ ููุฃุนูุงู
- โ ุฅุถุงูุฉ ุฅุฏุงุฑุฉ ุงููุญุงุฏุซุงุช
- โ ุฅุถุงูุฉ ุฅุฏุงุฑุฉ ูุงุนุฏุฉ ุงููุนุฑูุฉ
- โ ุชุญุณูู ุงูุฅุญุตุงุฆูุงุช ูุงูุชุญูููุงุช
- โ ุฅุถุงูุฉ ุนูููุงุช ุฌูุงุนูุฉ
- โ ุฅุถุงูุฉ ุชุตุฏูุฑ ุงูุจูุงูุงุช
- โ ุชุญุณูู ูุธุงู ุงูุตูุงุญูุงุช
- โ ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- โ ุฅุถุงูุฉ Audit Logging

ุฌููุน ุงูููุฒุงุช ุชุนูู ุจุดูู ููุทูู ููุชุฑุงุจุทุ ูุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู! ๐

